<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Gorilla Forest Jump</title>
  <style>
    html, body {
      width: 100vw;
      height: 100vh;
      margin: 0;
      padding: 0;
      overflow: hidden;
      background: linear-gradient(to top, #3a5f0b 0%, #7ec850 100%);
    }
    #gameCanvas {
      display: block;
      position: absolute;
      left: 0; top: 0;
      width: 100vw;
      height: 100vh;
      background: transparent;
      z-index: 1;
    }
    #uiOverlay {
      position: absolute;
      top: 0; left: 0;
      width: 100vw;
      height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      pointer-events: none;
      z-index: 2;
    }
    #startScreen, #gameOverScreen {
      background: rgba(255,255,255,0.92);
      border-radius: 24px;
      box-shadow: 0 8px 32px #0004;
      padding: 48px 64px;
      display: flex;
      flex-direction: column;
      align-items: center;
      pointer-events: auto;
    }
    .title {
      font-family: 'Segoe UI', Arial, sans-serif;
      font-size: 3em;
      font-weight: bold;
      color: #2d4d0a;
      margin-bottom: 16px;
      letter-spacing: 2px;
      text-shadow: 0 2px 8px #0002;
    }
    .desc {
      font-family: 'Segoe UI', Arial, sans-serif;
      font-size: 1.3em;
      color: #2d4d0a;
      margin-bottom: 32px;
      text-align: center;
      max-width: 400px;
    }
    .start-btn, .restart-btn {
      font-size: 2em;
      font-family: 'Segoe UI', Arial, sans-serif;
      font-weight: bold;
      background: #4caf50;
      color: #fff;
      border: none;
      border-radius: 18px;
      box-shadow: 0 4px 24px #0003;
      padding: 18px 48px;
      margin-top: 18px;
      cursor: pointer;
      letter-spacing: 2px;
      transition: background 0.2s, color 0.2s, transform 0.1s;
      outline: none;
      pointer-events: auto;
    }
    .start-btn:active, .restart-btn:active {
      background: #388e3c;
      color: #e0ffe0;
      transform: scale(0.97);
    }
    .press-space {
      margin-top: 12px;
      font-size: 1.1em;
      color: #2d4d0a;
      background: #fff8;
      padding: 6px 18px;
      border-radius: 10px;
      font-family: 'Segoe UI', Arial, sans-serif;
      font-weight: 500;
      letter-spacing: 1px;
      animation: blink 1.2s infinite alternate;
      display: inline-block;
    }
    @keyframes blink {
      from { opacity: 1; }
      to { opacity: 0.4; }
    }
    #scoreDisplay {
      position: absolute;
      top: 24px;
      left: 50%;
      transform: translateX(-50%);
      font-family: 'Segoe UI', Arial, sans-serif;
      font-size: 2em;
      color: #fff;
      text-shadow: 0 2px 8px #0008;
      z-index: 3;
      pointer-events: none;
      user-select: none;
      letter-spacing: 2px;
    }
  </style>
</head>
<body>
  <canvas id="gameCanvas"></canvas>
  <div id="uiOverlay">
    <div id="scoreDisplay" style="display:none;">Score: 0</div>
    <div id="startScreen">
      <div class="title">Gorilla Forest Jump</div>
      <div class="desc">
        Help the gorilla jump from tree to tree in the lush forest!<br>
        <b>Press SPACE or click to jump!</b><br>
        How far can you go?
      </div>
      <button class="start-btn" id="startBtn">START</button>
      <div class="press-space">or press SPACE</div>
    </div>
    <div id="gameOverScreen" style="display:none;">
      <div class="title">Game Over</div>
      <div class="desc" id="finalScore"></div>
      <button class="restart-btn" id="restartBtn">RESTART</button>
      <div class="press-space">or press SPACE</div>
    </div>
  </div>
  <script>
    // --- Game Constants ---
    let canvas, ctx, W, H;
    let gameState = 'start'; // start, playing, gameover
    let gorilla, trees, score, gravity, jumpPower, treeGap, treeSpeed, groundY, cameraX;
    let lastTime = 0;

    // --- Helper: DOMContentLoaded to ensure elements exist ---
    document.addEventListener('DOMContentLoaded', function() {
      canvas = document.getElementById('gameCanvas');
      ctx = canvas.getContext('2d');
      W = window.innerWidth;
      H = window.innerHeight;

      function resizeCanvas() {
        W = window.innerWidth;
        H = window.innerHeight;
        canvas.width = W;
        canvas.height = H;
        if (typeof groundY !== 'undefined') {
          groundY = H - 60;
        }
      }
      window.addEventListener('resize', resizeCanvas);
      resizeCanvas();

      // --- Gorilla Sprite (simple SVG path) ---
      function drawGorilla(x, y, scale = 1, facing = 1) {
        ctx.save();
        ctx.translate(x, y);
        ctx.scale(scale * facing, scale);
        // Body
        ctx.beginPath();
        ctx.ellipse(0, 30, 32, 38, 0, 0, Math.PI * 2);
        ctx.fillStyle = "#444";
        ctx.fill();
        // Head
        ctx.beginPath();
        ctx.ellipse(0, -18, 22, 26, 0, 0, Math.PI * 2);
        ctx.fillStyle = "#444";
        ctx.fill();
        // Face
        ctx.beginPath();
        ctx.ellipse(0, -10, 14, 13, 0, 0, Math.PI * 2);
        ctx.fillStyle = "#bbb";
        ctx.fill();
        // Eyes
        ctx.beginPath();
        ctx.ellipse(-5, -15, 2.5, 4, 0, 0, Math.PI * 2);
        ctx.ellipse(5, -15, 2.5, 4, 0, 0, Math.PI * 2);
        ctx.fillStyle = "#fff";
        ctx.fill();
        ctx.beginPath();
        ctx.ellipse(-5, -13, 1, 1.5, 0, 0, Math.PI * 2);
        ctx.ellipse(5, -13, 1, 1.5, 0, 0, Math.PI * 2);
        ctx.fillStyle = "#222";
        ctx.fill();
        // Mouth
        ctx.beginPath();
        ctx.moveTo(-5, 0);
        ctx.quadraticCurveTo(0, 6, 5, 0);
        ctx.lineWidth = 2;
        ctx.strokeStyle = "#222";
        ctx.stroke();
        // Arms
        ctx.beginPath();
        ctx.ellipse(-22, 30, 8, 22, Math.PI/6, 0, Math.PI * 2);
        ctx.ellipse(22, 30, 8, 22, -Math.PI/6, 0, Math.PI * 2);
        ctx.fillStyle = "#444";
        ctx.fill();
        // Legs
        ctx.beginPath();
        ctx.ellipse(-12, 60, 10, 16, Math.PI/10, 0, Math.PI * 2);
        ctx.ellipse(12, 60, 10, 16, -Math.PI/10, 0, Math.PI * 2);
        ctx.fillStyle = "#444";
        ctx.fill();
        ctx.restore();
      }

      // --- Tree Drawing ---
      function drawTree(x, y, trunkH, trunkW, branchY) {
        ctx.save();
        ctx.translate(x, y);
        // Trunk
        ctx.beginPath();
        ctx.moveTo(0, 0);
        ctx.lineTo(trunkW/2, trunkH);
        ctx.lineTo(-trunkW/2, trunkH);
        ctx.closePath();
        ctx.fillStyle = "#7a4b13";
        ctx.fill();
        // Branch
        ctx.beginPath();
        ctx.moveTo(0, branchY);
        ctx.lineTo(-60, branchY-10);
        ctx.lineTo(-60, branchY+10);
        ctx.lineTo(0, branchY+8);
        ctx.closePath();
        ctx.fillStyle = "#4e2e0e";
        ctx.fill();
        // Leaves
        ctx.beginPath();
        ctx.arc(-60, branchY, 32, 0, Math.PI * 2);
        ctx.fillStyle = "#2e7d32";
        ctx.globalAlpha = 0.7;
        ctx.fill();
        ctx.globalAlpha = 1;
        ctx.restore();
      }

      // --- Forest Background ---
      function drawBackground(cameraX) {
        // Sky
        ctx.fillStyle = "#aee571";
        ctx.fillRect(0, 0, W, H);
        // Parallax distant trees
        for (let i = -2; i < 10; ++i) {
          let tx = ((i * 320) - cameraX * 0.3) % (W + 320);
          if (tx < -320) tx += (W + 320);
          ctx.save();
          ctx.globalAlpha = 0.18;
          ctx.fillStyle = "#3a5f0b";
          ctx.fillRect(tx, H-260, 60, 260);
          ctx.beginPath();
          ctx.arc(tx+30, H-260, 60, 0, Math.PI * 2);
          ctx.fill();
          ctx.restore();
        }
        // Ground
        ctx.fillStyle = "#4caf50";
        ctx.fillRect(0, H-60, W, 60);
        // Bushes
        for (let i = 0; i < W; i += 120) {
          ctx.beginPath();
          ctx.arc(i+40, H-60, 32, 0, Math.PI * 2);
          ctx.arc(i+80, H-50, 24, 0, Math.PI * 2);
          ctx.fillStyle = "#388e3c";
          ctx.globalAlpha = 0.7;
          ctx.fill();
          ctx.globalAlpha = 1;
        }
      }

      // --- Game Reset ---
      function resetGame() {
        groundY = H - 60;
        gorilla = {
          x: 120,
          y: groundY - 60,
          vy: 0,
          onTree: true,
          facing: 1,
          scale: 1,
          jumpAnim: 0
        };
        cameraX = 0;
        score = 0;
        gravity = 0.7;
        jumpPower = -15;
        treeGap = 260;
        treeSpeed = 4.5;
        trees = [];
        // Place first tree under gorilla
        trees.push({
          x: 120,
          y: groundY,
          trunkH: 120 + Math.random()*40,
          trunkW: 36,
          branchY: 60 + Math.random()*30,
          passed: false
        });
        // Add more trees ahead
        for (let i = 1; i < 6; ++i) {
          let prev = trees[trees.length-1];
          let nx = prev.x + treeGap + Math.random()*60;
          trees.push({
            x: nx,
            y: groundY,
            trunkH: 120 + Math.random()*40,
            trunkW: 36,
            branchY: 60 + Math.random()*30,
            passed: false
          });
        }
      }

      // --- Game Loop ---
      function gameLoop(ts) {
        if (gameState !== 'playing') return;
        let dt = (ts - lastTime) / 16.67;
        if (!isFinite(dt) || dt > 5) dt = 1;
        lastTime = ts;

        // Physics
        gorilla.vy += gravity * dt;
        gorilla.y += gorilla.vy * dt;

        // Camera follows gorilla
        cameraX += ((gorilla.x - cameraX - 180) * 0.08);

        // Tree collision & landing
        let landed = false;
        for (let t of trees) {
          let branchX = t.x - cameraX;
          let branchY = t.y - t.branchY;
          if (
            Math.abs(gorilla.x - t.x) < 48 &&
            gorilla.y + 48 > branchY - 12 && gorilla.y + 48 < branchY + 24 &&
            gorilla.vy > 0
          ) {
            gorilla.y = branchY - 48;
            gorilla.vy = 0;
            gorilla.onTree = true;
            landed = true;
            gorilla.facing = 1;
            gorilla.jumpAnim = 0;
          }
          if (!t.passed && gorilla.x > t.x + 10) {
            t.passed = true;
            score++;
            document.getElementById('scoreDisplay').textContent = "Score: " + score;
          }
        }
        if (!landed) gorilla.onTree = false;

        // Ground collision
        if (gorilla.y + 64 > groundY) {
          gorilla.y = groundY - 64;
          gorilla.vy = 0;
          gorilla.onTree = true;
          gorilla.facing = 1;
          gorilla.jumpAnim = 0;
          if (!trees.some(t => Math.abs(gorilla.x - t.x) < 48 && Math.abs((groundY - t.branchY) - gorilla.y) < 32)) {
            endGame();
            return;
          }
        }

        // Remove trees behind, add new trees ahead
        while (trees.length && trees[0].x < cameraX - 200) trees.shift();
        while (trees.length < 8) {
          let last = trees[trees.length-1];
          let nx = last.x + treeGap + Math.random()*60;
          trees.push({
            x: nx,
            y: groundY,
            trunkH: 120 + Math.random()*40,
            trunkW: 36,
            branchY: 60 + Math.random()*30,
            passed: false
          });
        }

        // Draw
        ctx.clearRect(0, 0, W, H);
        drawBackground(cameraX);

        // Draw trees
        for (let t of trees) {
          drawTree(t.x - cameraX, t.y, t.trunkH, t.trunkW, t.branchY);
        }

        // Draw gorilla
        let scale = 1 + Math.max(-0.08, Math.min(0.08, gorilla.vy/30));
        drawGorilla(gorilla.x - cameraX, gorilla.y, scale, gorilla.facing);

        requestAnimationFrame(gameLoop);
      }

      // --- Input ---
      function jump() {
        if (gameState !== 'playing') return;
        if (gorilla.onTree) {
          gorilla.vy = jumpPower;
          gorilla.onTree = false;
          gorilla.facing = 1;
          gorilla.jumpAnim = 1;
          gorilla.x += 80 + Math.random()*30;
        }
      }

      // --- UI & State Management ---
      function startGame() {
        document.getElementById('startScreen').style.display = 'none';
        document.getElementById('gameOverScreen').style.display = 'none';
        document.getElementById('scoreDisplay').style.display = 'block';
        resetGame();
        gameState = 'playing';
        document.getElementById('scoreDisplay').textContent = "Score: 0";
        lastTime = performance.now();
        requestAnimationFrame(gameLoop);
      }
      function endGame() {
        gameState = 'gameover';
        document.getElementById('gameOverScreen').style.display = 'flex';
        document.getElementById('scoreDisplay').style.display = 'none';
        document.getElementById('finalScore').textContent = "Your Score: " + score;
      }
      function restartGame() {
        document.getElementById('gameOverScreen').style.display = 'none';
        startGame();
      }

      // --- Event Listeners ---
      document.getElementById('startBtn').addEventListener('click', function(e) {
        e.preventDefault();
        startGame();
      });
      document.getElementById('restartBtn').addEventListener('click', function(e) {
        e.preventDefault();
        restartGame();
      });

      // Fix: Prevent holding space from triggering multiple jumps or restarts
      let keyDownHandled = false;
      window.addEventListener('keydown', function(e) {
        if (keyDownHandled) return;
        if (e.code === 'Space' || e.key === ' ' || e.key === 'Spacebar') {
          keyDownHandled = true;
          if (gameState === 'start') {
            startGame();
            e.preventDefault();
          } else if (gameState === 'playing') {
            jump();
            e.preventDefault();
          } else if (gameState === 'gameover') {
            restartGame();
            e.preventDefault();
          }
        }
      });
      window.addEventListener('keyup', function(e) {
        if (e.code === 'Space' || e.key === ' ' || e.key === 'Spacebar') {
          keyDownHandled = false;
        }
      });

      window.addEventListener('mousedown', function(e) {
        if (e.button !== 0) return;
        if (gameState === 'start') startGame();
        else if (gameState === 'playing') jump();
        else if (gameState === 'gameover') restartGame();
      });

      // --- Initial State ---
      document.getElementById('scoreDisplay').style.display = 'none';
      document.getElementById('gameOverScreen').style.display = 'none';
      document.getElementById('startScreen').style.display = 'flex';
    }); // End DOMContentLoaded
  </script>
</body>
</html>